<!doctype html>



  


<html class="theme-next muse use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="architecture," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta name="description" content="概述MVP(Model-View-Presenter)是传统MVC(Model-View-Controller)在Android开发上的一种变种、进化模式。主要用来隔离UI、UI逻辑和业务逻辑、数据,创建松散耦合并可重用的对象。
我们知道View层是容易变化且多种多样的,业务逻辑也是多种多样的,与传统的MVC相比,P充当了C的作用.Model存储数据，View表示Model的表现，Presente">
<meta property="og:type" content="article">
<meta property="og:title" content="浅谈Android架构之MVP,MVVM">
<meta property="og:url" content="http://yoursite.com/2016/06/09/android-mvp-md/index.html">
<meta property="og:site_name" content="BoBoMEe">
<meta property="og:description" content="概述MVP(Model-View-Presenter)是传统MVC(Model-View-Controller)在Android开发上的一种变种、进化模式。主要用来隔离UI、UI逻辑和业务逻辑、数据,创建松散耦合并可重用的对象。
我们知道View层是容易变化且多种多样的,业务逻辑也是多种多样的,与传统的MVC相比,P充当了C的作用.Model存储数据，View表示Model的表现，Presente">
<meta property="og:image" content="http://img.blog.csdn.net/20160609230144717">
<meta property="og:image" content="http://img.blog.csdn.net/20160609230312969">
<meta property="og:image" content="http://img.blog.csdn.net/20160609230346176">
<meta property="og:image" content="http://img.blog.csdn.net/20160609230425176">
<meta property="og:image" content="http://img.blog.csdn.net/20160609230727130">
<meta property="og:updated_time" content="2016-07-27T13:03:08.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="浅谈Android架构之MVP,MVVM">
<meta name="twitter:description" content="概述MVP(Model-View-Presenter)是传统MVC(Model-View-Controller)在Android开发上的一种变种、进化模式。主要用来隔离UI、UI逻辑和业务逻辑、数据,创建松散耦合并可重用的对象。
我们知道View层是容易变化且多种多样的,业务逻辑也是多种多样的,与传统的MVC相比,P充当了C的作用.Model存储数据，View表示Model的表现，Presente">
<meta name="twitter:image" content="http://img.blog.csdn.net/20160609230144717">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: '博主'
    }
  };
</script>

  <title> 浅谈Android架构之MVP,MVVM | BoBoMEe </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">BoBoMEe</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">好好学习，天天向上</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                浅谈Android架构之MVP,MVVM
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-06-09T11:48:32+08:00" content="Jun 9 2016">
              Jun 9 2016
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p><code>MVP(Model-View-Presenter)</code>是传统<code>MVC(Model-View-Controller)</code>在Android开发上的一种变种、进化模式。主要用来隔离UI、UI逻辑和业务逻辑、数据,创建松散耦合并可重用的对象。</p>
<p>我们知道View层是容易变化且多种多样的,业务逻辑也是多种多样的,与传统的MVC相比,P充当了C的作用.<br>Model存储数据，View表示Model的表现，Presenter协调两者之间的通信.</p>
<p>而后在MVP基础上也出现了一些变种,如MVVM,MVPVM等,相比较MVP而言,MVVM使数据绑定变得更加简单.MVPVM在MVVM中加入引入Presenter层</p>
<a id="more"></a>
<h2 id="MVC-MVP-MVVM-MVPVM图解"><a href="#MVC-MVP-MVVM-MVPVM图解" class="headerlink" title="MVC,MVP,MVVM,MVPVM图解"></a>MVC,MVP,MVVM,MVPVM图解</h2><p>这里感谢源博客和图片提供者.</p>
<h3 id="MVC"><a href="#MVC" class="headerlink" title="MVC:"></a>MVC:</h3><p><img src="http://img.blog.csdn.net/20160609230144717" alt="MVC_Android MVP模式 简单易懂的介绍方式"></p>
<p>MVC中View接受事件,并调用Controller来操作Model,同时,当Model实例的数据发生变化后，Controller再更新界面(当然View也可以直接更新Model)。</p>
<p>在传统的开发中Activity俨然既充当了Controller又充当了View的作用.既需要接受用户响应操作Model,又要更新界面.<br>这样做有一个好处就是数据的更新变得很简单,但是缺点也十分明显,Activity是非臃肿,后期不好维护.</p>
<h3 id="MVP"><a href="#MVP" class="headerlink" title="MVP:"></a>MVP:</h3><p><img src="http://img.blog.csdn.net/20160609230312969" alt="MVP_Android MVP模式 简单易懂的介绍方式"></p>
<p>MVP中将业务逻辑单独抽出Presenter,View层变成一个被动的东西,Presenter负责完成View层与Model层的交互.<br>View 不可以直接和Model交互(MVC中允许Model和View交互),只有Presenter告知其更新，它才会去更新.<br>而且Presenter和View的交互是通过接口来完成.</p>
<h3 id="MVVM"><a href="#MVVM" class="headerlink" title="MVVM:"></a>MVVM:</h3><p><img src="http://img.blog.csdn.net/20160609230346176" alt="MVVM_MVVM_Android-CleanArchitecture"></p>
<p>MVVM在Android上对应data binding,MVVM最先使用在WPF中,通过ViewModel和View的映射,完成了View和Model的双向绑定.<br>View的事件直接传递到ViewModel，ViewModel去对Model进行操作并接受更新.进而反馈到View上.<br>因为ViewModel与View的耦合,MVVM有一个缺点就是View的复用问题,<br>因为去掉了Presenter,View层依然过重.</p>
<h3 id="MVPVM"><a href="#MVPVM" class="headerlink" title="MVPVM:"></a>MVPVM:</h3><p><img src="http://img.blog.csdn.net/20160609230425176" alt="MVPVM_从零开始的Android新项目3 - MVPVM in Action, 谁告诉你MVP和MVVM是互斥的"></p>
<p>MVPVM是MVP和MVVM的演化版本,降低了ViewModel与View的耦合,View只需要实现ViewModel的观察者接口实现更新.ViewModel不再对Model直接进行操作,而是交给了Presenter.Presenter操作Model并反馈到ViewModel上<br>Model,View,ViewModel之间通过Presenter联系了起来.</p>
<h2 id="MVP实践"><a href="#MVP实践" class="headerlink" title="MVP实践"></a>MVP实践</h2><p>Google官方<a href="https://github.com/googlesamples/android-architecture" target="_blank" rel="external">android-architecture </a>无疑是学习MVP最佳资料,官方项目展示了通过不同方式来实现MVP,其中展示了通过basic,loaders,data binding,clean,dagger,content provider,rxjava等不同方式来实现相同的功能,当然我们只要掌握其精髓,触类旁通就可以</p>
<h3 id="看官方MVP的体会"><a href="#看官方MVP的体会" class="headerlink" title="看官方MVP的体会"></a>看官方MVP的体会</h3><ul>
<li><p>单独模块抽取<code>IContract</code>接口管理<code>IView</code>和 <code>Presenter</code>接口,一目了然,而且维护也方便</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">AddEditTaskContract</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">interface</span> <span class="title">View</span> <span class="keyword">extends</span> <span class="title">BaseView</span>&lt;<span class="title">Presenter</span>&gt; </span>&#123;</span><br><span class="line"><span class="comment">//...</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">interface</span> <span class="title">Presenter</span> <span class="keyword">extends</span> <span class="title">BasePresenter</span> </span>&#123;</span><br><span class="line"><span class="comment">//...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>当Fragment作为<code>View</code>的时候,Activity负责创建<code>IView</code>和<code>Presenter</code>实例,并将二者关联起来,官方的这幅图即可说明</p>
</li>
</ul>
<p><img src="http://img.blog.csdn.net/20160609230727130" alt="fragment_mvp"></p>
<p>代码说明:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//todo-mvp$TasksActivity</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">       setContentView(R.layout.tasks_act);</span><br><span class="line">       <span class="comment">// ...</span></span><br><span class="line">       TasksFragment tasksFragment =</span><br><span class="line">               (TasksFragment) getSupportFragmentManager().findFragmentById(R.id.contentFrame);</span><br><span class="line">       <span class="comment">//...</span></span><br><span class="line">       mTasksPresenter = <span class="keyword">new</span> TasksPresenter(</span><br><span class="line">               Injection.provideTasksRepository(getApplicationContext()), tasksFragment);</span><br><span class="line">       <span class="comment">//...</span></span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><p><code>IPresenter</code>由具体的<code>Presenter</code>实现,<code>IView</code>由View层(<code>Activity/Fragment</code>)实现,<code>IView</code>实现类中包含了<code>Presenter</code>,他们通过如下方式实现绑定.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">BaseView</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">      <span class="comment">// View中保持对Presenter的引用。</span></span><br><span class="line">      <span class="function"><span class="keyword">void</span> <span class="title">setPresenter</span><span class="params">(T presenter)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>同时在<code>Presenter</code>构造时需要传入<code>IView</code>对象(用于更新<code>View</code>).</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TasksPresenter</span> <span class="keyword">implements</span> <span class="title">TasksContract</span>.<span class="title">Presenter</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> TasksRepository mTasksRepository;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> TasksContract.View mTasksView;</span><br><span class="line"><span class="comment">//...</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">TasksPresenter</span><span class="params">(@NonNull TasksRepository tasksRepository, @NonNull TasksContract.View tasksView)</span> </span>&#123;</span><br><span class="line">        mTasksRepository = checkNotNull(tasksRepository, <span class="string">"tasksRepository cannot be null"</span>);</span><br><span class="line">        mTasksView = checkNotNull(tasksView, <span class="string">"tasksView cannot be null!"</span>);</span><br><span class="line"><span class="comment">//setPresenter</span></span><br><span class="line">        mTasksView.setPresenter(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>Model</code>不仅仅是<code>JavaBean</code>,而且拥有操作数据的业务逻辑(获取、存储、更新),同时<code>Model</code>也可以将业务抽成接口,这样就可以随意拓展数据源</li>
</ul>
<h2 id="MVP变种"><a href="#MVP变种" class="headerlink" title="MVP变种"></a>MVP变种</h2><p>MVP架构的好处就不多说了,但是使用<code>Activity/Fragment</code>作为<code>View</code>层有如下问题,<br>参考<a href="http://www.devtf.cn/?p=27" target="_blank" rel="external">一种在android中实现MVP模式的新思路</a></p>
<ul>
<li>当内存不足,Activity被回收后,这使得状态的保存和恢复成为问题,因为涉及到了Model操作.</li>
<li><p>生命周期的控制问题也很麻烦,需要在Presenter中写一大堆和生命周期相关的接口规范</p>
</li>
<li><p>Activity中包含了很多系统服务,逻辑操作方便</p>
</li>
</ul>
<h3 id="使用Activity-Fragment作为Presenter"><a href="#使用Activity-Fragment作为Presenter" class="headerlink" title="使用Activity/Fragment作为Presenter"></a>使用Activity/Fragment作为Presenter</h3><p><code>Activity/Fragment</code>中的系统服务和业务逻辑紧密相关.理想的状态是View不涉及到逻辑操作.</p>
<p><code>Activity/Fragment</code>作为Presenter,需要将其UI逻辑抽取到一个单独的类中来管理.</p>
<p>UI逻辑接口<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Vu</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">inflate</span><span class="params">(LayoutInflater inflater, ViewGroup container, Bundle bundle)</span></span>;</span><br><span class="line">    <span class="function">View <span class="title">getView</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>作为Presenter的BaseActivity,覆盖了所有生命周期方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">BasePresenterActivity</span>&lt;<span class="title">V</span> <span class="keyword">extends</span> <span class="title">Vu</span>&gt; <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> V vu;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            vu = getVuClass().newInstance();</span><br><span class="line">            vu.inflate(getLayoutInflater(), <span class="keyword">null</span>,<span class="keyword">null</span>);</span><br><span class="line">            setContentView(vu.getView());</span><br><span class="line">            onBindVu();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InstantiationException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        onDestroyVu();</span><br><span class="line">        vu = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">super</span>.onDestroy();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">abstract</span> Class&lt;V&gt; <span class="title">getVuClass</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onBindVu</span><span class="params">()</span></span>&#123;&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDestroyVu</span><span class="params">()</span> </span>&#123;&#125;;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="举个例子"><a href="#举个例子" class="headerlink" title="举个例子:"></a>举个例子:</h3><p>具体的UI逻辑,不论Presenter变为Activity还是Fragment都不用改变.在周期方法中改变View对外的操作即可.<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloVu</span> <span class="keyword">implements</span> <span class="title">Vu</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">View view;</span><br><span class="line">TextView helloView;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(LayoutInflater inflater, ViewGroup container)</span> </span>&#123;</span><br><span class="line">    view = inflater.inflate(R.layout.hello, container, <span class="keyword">false</span>);</span><br><span class="line">    helloView = (TextView) view.findViewById(R.id.hello);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> View <span class="title">getView</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> view;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setHelloMessage</span><span class="params">(String msg)</span></span>&#123;</span><br><span class="line">    helloView.setText(msg);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>具体的Presenter<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloActivity</span> <span class="keyword">extends</span> <span class="title">BasePresenterActivity</span> </span>&#123;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onBindVu</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    vu.setHelloMessage(<span class="string">"Hello World!"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> Class&lt;MainVu&gt; <span class="title">getVuClass</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> HelloVu.class;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="MVVM-数据的动态绑定"><a href="#MVVM-数据的动态绑定" class="headerlink" title="MVVM:数据的动态绑定"></a>MVVM:数据的动态绑定</h2><p>官方文档:<br><a href="https://developer.android.com/topic/libraries/data-binding/index.html" target="_blank" rel="external">https://developer.android.com/topic/libraries/data-binding/index.html</a><br>使用Data Binding后,我们的xml和之前是不太一样的.抄袭自官方文档</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;layout xmlns:android="http://schemas.android.com/apk/res/android"&gt;</span><br><span class="line">    &lt;data&gt;</span><br><span class="line">        &lt;variable name="user" type="com.example.User"/&gt;</span><br><span class="line">    &lt;/data&gt;</span><br><span class="line">    &lt;LinearLayout&gt;</span><br><span class="line">    ....</span><br><span class="line">    &lt;/LinearLayout&gt;</span><br><span class="line">&lt;/layout&gt;</span><br></pre></td></tr></table></figure>
<p>相应的Activity的setContentView也会变化</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">   <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">   MainActivityBinding binding = DataBindingUtil.setContentView(<span class="keyword">this</span>, R.layout.main_activity);</span><br><span class="line">   User user = <span class="keyword">new</span> User(<span class="string">"Test"</span>, <span class="string">"User"</span>);</span><br><span class="line">   binding.setUser(user);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里一个JavaBean对应一个xml布局文件,View的复用变得很困难.</p>
<h2 id="TheMVP-MVVM和MVP的结合"><a href="#TheMVP-MVVM和MVP的结合" class="headerlink" title="TheMVP:MVVM和MVP的结合"></a>TheMVP:MVVM和MVP的结合</h2><p>TheMVP解决了这个问题,通过在Presenter中定义ViewModel接口,实现数据的双向绑定与MVP的结合.<br>项目地址: <a href="https://github.com/kymjs" target="_blank" rel="external">kymjs</a>/<strong><a href="https://github.com/kymjs/TheMVP" target="_blank" rel="external">TheMVP</a></strong></p>
<p>核心代码:这里的IDelegate相当与上面的Vu<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ViewModel接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">DataBinder</span>&lt;<span class="title">T</span> <span class="keyword">extends</span> <span class="title">IDelegate</span>, <span class="title">D</span> <span class="keyword">extends</span> <span class="title">IModel</span>&gt; </span>&#123;</span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * 将数据与View绑定，这样当数据改变的时候，框架就知道这个数据是和哪个View绑定在一起的，就可以自动改变ui</span><br><span class="line">     * 当数据改变的时候，会回调本方法。</span><br><span class="line">     *</span><br><span class="line">     * <span class="doctag">@param</span> viewDelegate 视图层代理</span><br><span class="line">     * <span class="doctag">@param</span> data         数据模型对象</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">viewBindModel</span><span class="params">(T viewDelegate, D data)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Presenter:在数据改变的时候调用notifyModelChanged()更新View<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">DataBindActivity</span>&lt;<span class="title">T</span> <span class="keyword">extends</span> <span class="title">IDelegate</span>&gt; <span class="keyword">extends</span></span><br><span class="line">        <span class="title">ActivityPresenter</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> DataBinder binder;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> DataBinder <span class="title">getDataBinder</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> &lt;D extends IModel&gt; <span class="function"><span class="keyword">void</span> <span class="title">notifyModelChanged</span><span class="params">(D data)</span> </span>&#123;</span><br><span class="line">        binder.viewBindModel(viewDelegate, data);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="MVPVM-View复用与瘦身"><a href="#MVPVM-View复用与瘦身" class="headerlink" title="MVPVM:View复用与瘦身"></a>MVPVM:View复用与瘦身</h2><p>在MVPVM作者的介绍中.</p>
<ul>
<li>Model层,和MVP中的Model是类似的.即PO或者DO</li>
<li>View层,依然是由Activity/Fragment来担当,不同的是需要实现ViewModel的观察者接口,来实现View的动态更新</li>
<li>Presenter层,如上图所示,Presenter作为核心,连接着M,V,VM</li>
<li>VM层,和MVVM中的VM是类似的,只是为了让VM可以重用.不再和特定的View绑定,而且不再直接对Model进行操作.</li>
</ul>
<p>详见:<a href="http://blog.zhaiyifan.cn/2016/03/16/android-new-project-from-0-p3/" target="_blank" rel="external">从零开始的Android新项目3 - MVPVM in Action, 谁告诉你MVP和MVVM是互斥的</a></p>
<p>最后附上用MVP写的一个小Demo:<br><a href="https://github.com/BoBoMEe/AndroidDev/tree/mvp/MVP" target="_blank" rel="external">MVP</a></p>
<p>参考:<br><a href="http://www.devtf.cn/?p=27" target="_blank" rel="external">一种在android中实现MVP模式的新思路</a></p>
<p><a href="http://kaedea.com/2015/10/11/android-mvp-pattern/" target="_blank" rel="external">ANDROID MVP模式 简单易懂的介绍方式</a></p>
<p><a href="http://rocko.xyz/2015/11/07/MVVM_Android-CleanArchitecture/" target="_blank" rel="external">MVVM_Android-CleanArchitecture</a></p>
<p><a href="http://blog.zhaiyifan.cn/2016/03/16/android-new-project-from-0-p3/#rd?sukey=ecafc0a7cc4a741b87b0faa09babd83d0aaade29e75380871b478818ebd3831b8e0f7185e732c99cdeaa2efe0922b0f8" target="_blank" rel="external">从零开始的Android新项目3 - MVPVM in Action, 谁告诉你MVP和MVVM是互斥的</a></p>
<p><a href="http://kymjs.com/code/2015/11/09/01" target="_blank" rel="external">用MVP架构开发Android应用</a></p>

      
    </div>

    <div>
      
        
      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/architecture/" rel="tag">#architecture</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2016/06/05/dagger2basic/" rel="next" title="Android:Dagger2学习之由浅入深">
                <i class="fa fa-chevron-left"></i> Android:Dagger2学习之由浅入深
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2016/06/23/contentprovider/" rel="prev" title="android开发之contentprovider">
                android开发之contentprovider <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="bobomee" />
          <p class="site-author-name" itemprop="name">bobomee</p>
          <p class="site-description motion-element" itemprop="description">Android开发和学习笔记</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">16</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">11</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">
            
              
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#概述"><span class="nav-number">1.</span> <span class="nav-text">概述</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MVC-MVP-MVVM-MVPVM图解"><span class="nav-number">2.</span> <span class="nav-text">MVC,MVP,MVVM,MVPVM图解</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#MVC"><span class="nav-number">2.1.</span> <span class="nav-text">MVC:</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#MVP"><span class="nav-number">2.2.</span> <span class="nav-text">MVP:</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#MVVM"><span class="nav-number">2.3.</span> <span class="nav-text">MVVM:</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#MVPVM"><span class="nav-number">2.4.</span> <span class="nav-text">MVPVM:</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MVP实践"><span class="nav-number">3.</span> <span class="nav-text">MVP实践</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#看官方MVP的体会"><span class="nav-number">3.1.</span> <span class="nav-text">看官方MVP的体会</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MVP变种"><span class="nav-number">4.</span> <span class="nav-text">MVP变种</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#使用Activity-Fragment作为Presenter"><span class="nav-number">4.1.</span> <span class="nav-text">使用Activity/Fragment作为Presenter</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#举个例子"><span class="nav-number">4.2.</span> <span class="nav-text">举个例子:</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MVVM-数据的动态绑定"><span class="nav-number">5.</span> <span class="nav-text">MVVM:数据的动态绑定</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#TheMVP-MVVM和MVP的结合"><span class="nav-number">6.</span> <span class="nav-text">TheMVP:MVVM和MVP的结合</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MVPVM-View复用与瘦身"><span class="nav-number">7.</span> <span class="nav-text">MVPVM:View复用与瘦身</span></a></li></ol></div>
            
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">bobomee</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.0.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.0.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  



  




  
  
  

  

  

</body>
</html>
